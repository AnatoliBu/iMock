# WireMock Viewer и Редактор

## Содержание
1. [Введение](#введение)
2. [Установка и Запуск](#установка-и-запуск)
3. [Интерфейс Пользователя](#интерфейс-пользователя)
4. [Работа с Маппингами](#работа-с-маппингами)
5. [Редактирование Маппингов](#редактирование-маппингов)
6. [JSON Редактор](#json-редактор)
7. [Функции Прокси](#функции-прокси)
8. [Устранение Проблем](#устранение-проблем)
9. [Архитектура Приложения](#архитектура-приложения)
10. [API Справочник](#api-справочник)

## Введение

WireMock Viewer — это мощный инструмент для управления маппингами WireMock с удобным пользовательским интерфейсом. Инструмент предназначен для упрощения работы с API-заглушками системы Iiko, но может быть использован для любых WireMock-серверов.

### Основные возможности:

- Просмотр и фильтрация маппингов WireMock
- Детальное изучение запросов и ответов маппингов
- Редактирование существующих маппингов
- Создание и удаление маппингов
- Работа с прокси-маппингами
- Интеграция с WireMock API
- Обход CORS-ограничений через встроенный прокси-сервер
- Удобный JSON-редактор с возможностью полноэкранного режима

Инструмент разработан с акцентом на удобство использования и визуальное редактирование маппингов, что значительно упрощает процесс создания и отладки заглушек API.

## Установка и Запуск

### Требования

- Node.js (рекомендуется для полной функциональности) или Python
- Доступ к WireMock-серверу
- Современный браузер (Chrome, Firefox, Edge, Safari)

### Установка

1. Скопируйте директорию `tools/wiremock_viewer` в удобное для вас место
2. Убедитесь, что у скрипта `run.sh` есть права на выполнение:
   ```bash
   chmod +x run.sh
   ```

### Запуск

1. Перейдите в директорию с инструментом:
   ```bash
   cd tools/wiremock_viewer
   ```

2. Запустите скрипт `run.sh`:
   ```bash
   ./run.sh
   ```

3. В браузере автоматически откроется адрес `http://localhost:8000`

## Интерфейс Пользователя

Интерфейс WireMock Viewer разделен на следующие основные области:

### 1. Панель настроек и фильтров

Находится в верхней части экрана и может быть свернута. Включает:

- **URL сервера** — адрес WireMock-сервера
- **Токен** — токен авторизации для доступа к WireMock API
- **Кнопка "Загрузить маппинги"** — запускает загрузку маппингов с указанного сервера
- **Фильтр** — позволяет фильтровать маппинги по тексту
- **Тип** — выбор категории маппингов (Все, Аутентификация, Меню, и т.д.)

### 2. Список маппингов

Отображается в левой части экрана и содержит карточки маппингов со следующей информацией:
- Метод запроса (GET, POST, PUT, DELETE, ANY)
- Тип URL (Exact, Pattern, Path)
- URL маппинга
- Индикатор прокси (если маппинг является прокси)
- ID маппинга
- Имя маппинга
- Статус ответа
- Кнопка "Редактировать"

Клик по карточке маппинга (не по кнопке) раскрывает детали маппинга.

### 3. Редактор маппингов

Открывается при нажатии на кнопку "Редактировать" в карточке маппинга и содержит вкладки:
- **Запрос** — редактирование параметров запроса
- **Ответ** — редактирование параметров ответа
- **Прокси** — настройки прокси (для прокси-маппингов)
- **Метаданные** — дополнительные настройки маппинга
- **JSON** — редактирование JSON-представления маппинга

## Работа с Маппингами

### Загрузка маппингов

1. Укажите URL WireMock-сервера (по умолчанию `http://rdsh2.lphub.net:8080`)
2. При необходимости укажите токен авторизации (по умолчанию `Bearer test`)
3. Нажмите кнопку "Загрузить маппинги"

### Фильтрация маппингов

- Используйте текстовое поле "Фильтр" для поиска по URL, методу, ID или имени маппинга
- Используйте выпадающий список "Тип" для фильтрации по категориям маппингов
- Фильтрация происходит в реальном времени при вводе текста или изменении типа

### Просмотр деталей маппинга

1. Нажмите на карточку маппинга в списке (не на кнопку "Редактировать")
2. Откроется детальное представление маппинга с информацией о запросе, ответе и дополнительных параметрах

### Удаление маппинга

1. Нажмите на кнопку "Редактировать" в карточке маппинга
2. В открывшемся редакторе нажмите кнопку "Удалить"
3. Подтвердите удаление в диалоговом окне

## Редактирование Маппингов

### Редактирование существующего маппинга

1. Нажмите на кнопку "Редактировать" в карточке маппинга
2. В редакторе внесите необходимые изменения, используя вкладки
3. Нажмите кнопку "Сохранить" для сохранения изменений
4. Или нажмите "Отмена" для отмены изменений

### Вкладки редактора

#### Вкладка "Запрос"
- **Метод** — метод HTTP-запроса
- **URL** — URL или шаблон URL
- **Headers** — заголовки запроса
- **Body Pattern** — шаблон тела запроса в формате JSON

#### Вкладка "Ответ"
- **Статус код** — код HTTP-ответа
- **Headers** — заголовки ответа
- **Body** — тело ответа
- **Задержка (мс)** — искусственная задержка ответа

#### Вкладка "Прокси" (видима только для прокси-маппингов)
- **URL прокси** — URL, на который будет перенаправлен запрос
- **Дополнительные заголовки прокси-запроса** — заголовки, добавляемые к прокси-запросу

#### Вкладка "Метаданные"
- **Название** — имя маппинга
- **Приоритет** — приоритет маппинга
- **Постоянный** — флаг постоянства маппинга

#### Вкладка "JSON"
- Полное JSON-представление маппинга для прямого редактирования

## JSON Редактор

WireMock Viewer включает мощный JSON-редактор для работы с шаблонами запросов, телами ответов и полным JSON-представлением маппингов.

### Особенности JSON-редактора

- **Подсветка синтаксиса** — цветовая подсветка для улучшения читаемости JSON
- **Номера строк** — отображение номеров строк
- **Сворачивание/разворачивание** — возможность свернуть или развернуть блоки JSON
- **Режимы отображения** — режимы "Код" и "Дерево"
- **Поиск** — встроенный поиск по содержимому
- **Полноэкранный режим** — возможность развернуть редактор на весь экран

### Использование полноэкранного режима

1. Нажмите на кнопку <span class="expand-icon">⤢</span> в правом верхнем углу JSON-редактора
2. Редактор развернется на весь экран
3. Для выхода из полноэкранного режима нажмите кнопку "Закрыть [Esc]" или клавишу Esc на клавиатуре

### Режимы редактирования

- **Режим "Код"** — редактирование JSON как текст с подсветкой синтаксиса
- **Режим "Дерево"** — редактирование JSON как иерархическая структура

Для переключения между режимами используйте меню в верхнем левом углу редактора.

## Функции Прокси

WireMock Viewer включает встроенный прокси-сервер для обхода CORS-ограничений, которые часто возникают при работе с WireMock API из браузера.

### Прокси-сервер

- Запускается автоматически при старте приложения через скрипт `run.sh`
- Работает на порту 8000
- Перенаправляет запросы к WireMock API, добавляя необходимые заголовки CORS

### Прокси-маппинги

Кроме технического прокси-сервера, WireMock Viewer поддерживает работу с прокси-маппингами WireMock:

1. При редактировании маппинга перейдите на вкладку "Прокси"
2. Укажите URL, на который будут проксироваться запросы
3. При необходимости добавьте дополнительные заголовки прокси-запроса
4. Сохраните маппинг

Прокси-маппинги отображаются в списке с индикатором прокси-URL и имеют специальное оформление.

## Устранение Проблем

### CORS-ограничения

Если вы сталкиваетесь с CORS-ошибками при работе с WireMock API:

1. Убедитесь, что запущен прокси-сервер через скрипт `run.sh`
2. Проверьте, установлен ли Node.js для полноценной работы прокси
3. Если Node.js не установлен, будет использован Python-сервер, который не решает CORS-проблемы

### Проблемы авторизации

Если у вас возникают проблемы с авторизацией:

1. Проверьте правильность токена авторизации
2. Убедитесь, что токен не истек
3. Проверьте, что у вас есть доступ к WireMock API

### Проблемы при сохранении маппингов

Если не удается сохранить маппинг:

1. Убедитесь, что маппинг имеет корректный формат
2. Проверьте, что все обязательные поля заполнены
3. Убедитесь, что у вас есть права на редактирование маппингов
4. Проверьте консоль разработчика в браузере на наличие ошибок

## Архитектура Приложения

WireMock Viewer состоит из следующих компонентов:

### Клиентская часть
- **HTML** (`index.html`) — структура пользовательского интерфейса
- **CSS** (`style.css`) — стили пользовательского интерфейса
- **JavaScript** (`script.js`) — логика приложения

### Серверная часть
- **Прокси-сервер** (`proxy.js`) — Node.js-сервер для обхода CORS-ограничений
- **Скрипт запуска** (`run.sh`) — скрипт для запуска приложения

### Сторонние библиотеки
- **JSONEditor** — библиотека для редактирования JSON

## API Справочник

WireMock Viewer взаимодействует с WireMock API. Ниже приведены основные API-методы, используемые приложением:

### Получение маппингов
```
GET /__admin/mappings
```

### Получение одного маппинга
```
GET /__admin/mappings/{id}
```

### Обновление маппинга
```
PUT /__admin/mappings/{id}
Content-Type: application/json
```

### Удаление маппинга
```
DELETE /__admin/mappings/{id}
```

Для более подробной информации о WireMock API смотрите [официальную документацию WireMock](http://wiremock.org/docs/api/). 